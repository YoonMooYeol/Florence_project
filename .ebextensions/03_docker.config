files:
  "/opt/elasticbeanstalk/hooks/appdeploy/post/01_migrate.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/usr/bin/env bash
      if [ -f /tmp/leader_only ]; then
        docker-compose -f /var/app/current/docker-compose.yml run web python manage.py migrate
        rm /tmp/leader_only
      fi

container_commands:
  01_migrate:
    command: "touch /tmp/leader_only"
    leader_only: true
  02_collectstatic:
    command: "docker-compose run web python manage.py collectstatic --noinput" 